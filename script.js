document.addEventListener("touchmove",function(e){e.preventDefault()},false);document.addEventListener("touchhold",function(e){e.preventDefault()},false);var SLticketContents=[["Reducerat pris","reducedprice"],["Zon A","zonea"],["Zon B","zoneb"],["Zon C","zonec"],["Länspassage","lanspassage"]];var GBticketContents=[["Reducerat pris","reducedprice"],["Natt","gbgn"],["Göteborg","gbg"],["Göteborg +","gbgp"],["Göteborg ++","gbgpp"],["Göteborg +++","gbgppp"]];var unknownCode=["4U","9Q","4B","7D","6M","3V","5V","1S","7Y"];var textbase="0123456789";var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ";var plustext="AEOX";var months=["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"];var firstnameList=new Array("Christian","Anders","Martin","John","Jessica","Lucas","Carl","Filip","Daniel","Johan","Kim","Anna","Felicia","Fredrik","Magnus","Pär","David","Jonas","Simon","Angelica","Adnan","Isaac","Michael","Yvonne","Staffan","Lars","Harris","Erik","Tina","Peter","Julia","Cecilia","Jakob","William","Lennart","Joakim","Marcus","Gunilla","Camilla","Bettan","Olga","Louis","Alma","Mary","Fredrika","Josefin","Matilda","Eva","Marie","Karl","Jan","Uno","Hans","Heidar","Sven","Gunnar","Rimon","Houman","Nils","Per");var lastnameList=new Array("Granlund","Lundberg","Andersson","Holmberg","","Grufman","","Kalderén","Holm","Carlsson","","Jobb","Tele2","Frost","Hansson","Knutsson","Blomberg","Almlöf","Dahl","Höglund","Asplund","Edman","Ingdahl","Hällström","Ek","Bäckström","Ekblad","Eriksson","Kvick","","Bonnier","","Telia","","","Lidén","Norrman","","","Rydén","Lantz","","","","","","","Klasson","Lindblad","Molin","","Englund","Ottosson","Rosén","Ekman","Boström","Hallberg","Borg","Palm","Jönsson");var messagesList=new Array("Kommer ni i helgen?","Kan du åka förbi Jonas efter jobbet?","Blir du sen ikväll med?","Lunch idag?","Kan du tanka mitt kontantkort?","SVARA!!!","Ringer dig efter mötet.","Mötet flyttat till 14.00!","Suveränt!","Tackar!","Okej.","Bilen är nu klar att hämta.","Har din sambo sagt något?","Kan inte hitta bilnycklarna... ","Vad blir det för mat ikväll?","Vi får handla något för imorgon.","Kanon! Tack","Någon annan kväll får det bli.","Kan tyvärr inte.","Japp!","Klockan fyra blir perfekt!","Krya på dig!","Härligt.","Jag lär bli sen","Bussen går om 5 min","Vi möts på Wayne's Coffe kl 2","Helt fel","Ja, det ska jag.","Ring","Har du kontokortet på dig?","Du glömde ditt busskort!","Sms:a 072-305 03 92.","Viktigt! svara","Lika bra att fråga","Skynda dig","Gör så","Har du Agnetas nummer?","Blir sen till mötet.","Jaja","Allt är bara bra, sj?","Vi ses i Kista Galleria.","Måste förbi The Phone House först.","Ska möta henne senare ikväll, varför?","Haha","Det blir bra som det är asså","Ska du ha något från Ica?","Jag är på tåget","Hurså?","Vi ses där","Jaja, det är bara att ringa","Jorå, det går bra hälsa från Martin.","Nej","Aldrig!!","Ska hämta upp ungarna.","Åker förbi Hemköp!så att du vet :)","Gissa vem jag såg! Såg din chef i centralen, vad han har blivit stor ha!","Ska klippa mig.","Ring mig, det är viktig.","Möter du oss eller?","Någonstans mellan 21 och 23 tror jag.","Vadåra?","Har han sagt något?","Kan du ge han mitt nummer?tack","Överför 1000kr till mitt konto.","Resan kostar 5000 inkl hotell","Ska vi ut ikväll?","Vi ses.","Ok","Nää","Varför?","Jag kan inte,vi får ta det imorgon helt enkelt!","Slutar om en kvart","Ja","Hur?","När?","Var?","Kan du?","Glömde körkortet, haha.","Får lön den 25:e","Har tagit ut min semester nu, fyfan!","Sköt om dig");var weekDays=["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"];var redprices=[20,30,40];var fullprices=[36,54,72];var redpricesL=[20,40,50,60];var fullpricesL=[36,72,90,108];var ticketScroll;var keyboardVisible=false;var dragged=false;var contactbtnVisible=false;var copyVisible=false;var currPage="ticket";var currentViewportPage="settings";var updateButtonActive=false;var chooseTicketVisible=false;var aboutScroll;var ticketType;$(function(){if(localStorage.getItem("ticketType")===null){setTicketType("SL");$("#settingsHeader").text("Ny SL Biljett")}else{setTicketType(localStorage.getItem("ticketType"));$("#settingsHeader").text("Ny "+ticketType+" Biljett")}});var setTicketType=function(e){var t=$("#newticketform");t.html("");if(e=="SL"){for(var n=0;n<SLticketContents.length;n++){t.append('<div class="listitem"><span>'+SLticketContents[n][0]+'</span><div><input id="'+SLticketContents[n][1]+'" type="checkbox"/></div></div>');if(n==0){t.append("<hr>")}}ticketType="SL"}else if(e=="VT"){t.append('<div class="listitem"><span>'+GBticketContents[0][0]+'</span><div><input id="'+GBticketContents[0][1]+'" type="checkbox"/></div></div>');t.append('<div class="listitem"><span>'+GBticketContents[1][0]+'</span><div><input id="'+GBticketContents[1][1]+'" type="checkbox"/></div></div><hr>');for(var n=2;n<GBticketContents.length;n++){t.append('<div class="listitem"><span>'+GBticketContents[n][0]+'</span><div><input id="'+GBticketContents[n][1]+'" name="gbgtype" type="radio" class="gbgradio"/></div></div>')}ticketType="VT"}else{t.html("Invalid ticket type: "+e);ticketType="#"}localStorage.setItem("ticketType",ticketType);$("input").on("tap",function(e){$(this).prop("checked",!this.checked)})};var addcalclick=function(){$("#popup_bg").fadeIn("fast");$("#addtocalendar").animate({bottom:"0px"},200)};var getRandomChar=function(e){return e[Math.floor(Math.random()*e.length)]};var populateInbox=function(e){var t=[0,0,0,0,0,0,0,0,0];var n=new Date;for(var r=1;r<9;r++){rand=Math.ceil(Math.random()*6);t[r]=rand}t.sort();for(var r=1;r<10;r++){var i=Math.floor(Math.random()*firstnameList.length);var s=Math.floor(Math.random()*lastnameList.length);$("#inbox_fake_sms_"+r+"_t1").html(firstnameList[i]+" "+lastnameList[s]);var o=Math.floor(Math.random()*messagesList.length);if(messagesList[o].length<45){var u="<br />&nbsp;"}else{u=""}$("#inbox_fake_sms_"+r+"_t2").html(messagesList[o]+u);var a=new Date;a.setDate(e.getDate()-t[r-1]);if(t[r-1]==0){if(e.getHours()<2){$("#inboxgotit_"+r).html("igår")}else{var f=Math.floor(Math.random()*(e.getHours()-(e.getHours()-2)+1)+(e.getHours()-2));var l;if(f==e.getHours()){l=e.getMinutes()}else{l=59}var c=Math.floor(Math.random()*(l-0+1)+0);f=f<10?"0"+f:f;c=c<10?"0"+c:c;$("#inboxgotit_"+r).html(f+":"+c)}}else if(t[r-1]==1){$("#inboxgotit_"+r).html("igår")}else{$("#inboxgotit_"+r).html(weekDays[a.getDay()])}}};$(function(){function h(){var e=[25,49,60,93];var t=[19,37,45,70];var n=[50,74,85,118];var r=[44,62,70,95];var i=$("input[name=gbgtype]:checked").prop("id");if(i==null){alert("Du måste välja ett av alternativen!");return false}var s="";var o=localStorage.getItem("telenr")==null?"789":localStorage.getItem("telenr");while(s.length!=3||isNaN(s)){s=prompt("Ange de tre sista siffrorna i ditt telefonnummer: ",o);if(s==null)return false;else if(s.length!=3||isNaN(s))alert("Felaktig input!")}localStorage.setItem("telenr",s);var u;if($("#gbg").prop("checked"))u="G";if($("#gbgp").prop("checked"))u="GP";if($("#gbgpp").prop("checked"))u="GPP";if($("#gbgppp").prop("checked"))u="GPPP";if($("#gbgk").prop("checked"))u="KU";var a;if($("#reducedprice").prop("checked")){u+="S";a=getRandomChar("s");var f=" ";for(var l=0;l<u.length-2;l++){f+="+"}f+=" ";f=f.indexOf("+")==-1?" ":f;var c;if(f.length>1){c=f+"inom Göteborgs kommun"+f}else{c=f+"inom området Göteborg"+f}localStorage.setItem("zoneText1","SKOLUNGDOM GÖTEBORG"+c);if($("#gbgn").prop("checked")){localStorage.setItem("priceText1",r[u.length-2]);u+="N"}else{localStorage.setItem("priceText1",t[u.length-2])}localStorage.setItem("zoneText2",u)}else{u+="V";a=getRandomChar("veu");var f=" ";for(var l=0;l<u.length-2;l++){f+="+"}f+=" ";f=f.indexOf("+")==-1?" ":f;var f=" ";for(var l=0;l<u.length-2;l++){f+="+"}f+=" ";f=f.indexOf("+")==-1?" ":f;var c;if(f.length>1){c=f+"inom Göteborgs kommun"+f}else{c=f+"inom området Göteborg"+f}localStorage.setItem("zoneText1","VUXEN GÖTEBORG"+c);if($("#gbgn").prop("checked")){localStorage.setItem("priceText1",n[u.length-2]);u+="N"}else{localStorage.setItem("priceText1",e[u.length-2])}localStorage.setItem("zoneText2",u)}if(u.indexOf("P")!=-1)validTime=10800;else validTime=5400;var h=Math.round((new Date).getTime()/1e3);var p=new Date(h*1e3);var v=h+validTime;var m=new Date(v*1e3);var g=p.getDate();if(g<10)g=""+g;var y=p.getFullYear();if(y<10)y="0"+y;var b=p.getMonth()+1;if(b<10)b="0"+b;var w=months[p.getMonth()];var E=textbase.charAt(p.getMonth());var S=p.getHours();if(S<10)S="0"+S;var x=p.getMinutes();if(x<10)x="0"+x;var T=m.getDate();if(T<10)T="0"+T;var N=m.getFullYear();if(N<10)N="0"+N;var C=m.getMonth()+1;if(C<10)C="0"+C;var k=months[m.getMonth()];var L=m.getHours();if(L<10)L="0"+L;var A=m.getMinutes();if(A<10)A="0"+A;var O="";for(var l=0;l<4;l++){var M=Math.floor(Math.random()*textbase.length);O+=textbase.charAt(Math.floor(Math.random()*textbase.length))}var _=parseInt(x)+Math.floor(Math.random()*6)+1;_=_<9?"0"+_:_;O+=""+_;var D="+-/*";var P=D[Math.floor(Math.random()*D.length)];var H=alphabet[p.getMonth()];if(u.match("PPP")!=null){a=getRandomChar("uU")+getRandomChar("sS")+a}else if(u.match("PP")!=null){a=getRandomChar("uU")+getRandomChar("sS")+a}else if(u.match("P")!=null){a=getRandomChar("gG")+getRandomChar("sS")+a}else{a=getRandomChar("gG")+getRandomChar("tT")+a}var B=unknownCode[p.getMinutes()%unknownCode.length];var j=v.toString();j=j.substring(j.length-6,j.length);var F=S+""+x+""+H+""+g+""+a+""+s+""+B+""+j;localStorage.setItem("code",F);localStorage.setItem("sender_number",O);localStorage.setItem("magic_number",_);localStorage.setItem("msg_symbol",P);localStorage.setItem("validuntil",v);localStorage.setItem("order_Date",g);localStorage.setItem("order_Year",y);localStorage.setItem("order_Month",b);localStorage.setItem("order_Month2",E);localStorage.setItem("order_Month_text",w);localStorage.setItem("order_Hour",S);localStorage.setItem("order_Minute",x);localStorage.setItem("until_Date",T);localStorage.setItem("until_Year",N);localStorage.setItem("until_Month",C);localStorage.setItem("until_Minute",A);localStorage.setItem("until_Hour",L);localStorage.setItem("until_Minute",A);d(true)}function p(){if(!$("#zonea").prop("checked")&&!$("#zoneb").prop("checked")&&!$("#zonec").prop("checked")&&!$("#lanspassage").prop("checked")){alert("Minst en zon måste vara vald!");return false}else if($("#lanspassage").prop("checked")){if($("#zonea").prop("checked")&&!$("#zoneb").prop("checked")&&!$("#zonec").prop("checked")){alert("Ogiltig kombination med länspassage!");return false}else if(!$("#zonea").prop("checked")&&$("#zoneb").prop("checked")&&!$("#zonec").prop("checked")){alert("Ogiltig kombination med länspassage!");return false}else if($("#zonea").prop("checked")&&$("#zoneb").prop("checked")&&!$("#zonec").prop("checked")){alert("Ogiltig kombination med länspassage!");return false}else if($("#zonea").prop("checked")&&!$("#zoneb").prop("checked")&&$("#zonec").prop("checked")){alert("Ogiltig kombination med länspassage!");return false}}var e=Math.round((new Date).getTime()/1e3);var t=new Date(e*1e3);var n="";if($("#zonea").prop("checked"))n+="A";if($("#zoneb").prop("checked"))n+="B";if($("#zonec").prop("checked"))n+="C";var r=false;if($("#lanspassage").prop("checked"))r=true;if($("#reducedprice").prop("checked")){localStorage.setItem("zoneText1","R");localStorage.setItem("priceText1","Red pris");if(r){localStorage.setItem("zoneText2",n+"L");localStorage.setItem("priceText2",redpricesL[n.length])}else{localStorage.setItem("zoneText2",n);localStorage.setItem("priceText2",redprices[n.length-1])}}else{localStorage.setItem("zoneText1","H");localStorage.setItem("priceText1","Helt pris");if(r){localStorage.setItem("zoneText2",n+"L");localStorage.setItem("priceText2",fullpricesL[n.length])}else{localStorage.setItem("zoneText2",n);localStorage.setItem("priceText2",fullprices[n.length-1])}}if(n=="ABC"||n==""&&r)validTime=7200;else validTime=4500;var i=e+validTime;var s=new Date(i*1e3);var o=Math.floor(Math.random()*10);var u=Math.floor(Math.random()*10);var a=Math.floor(Math.random()*10);var f=Math.floor(Math.random()*10);var l=Math.floor(Math.random()*10);var c=Math.floor(Math.random()*10);var h=Math.floor(Math.random()*10);var p;if(Math.random()<.7){var v=Math.floor(Math.random()*10);p=Math.floor(Math.random()*10)+""+v}else{p=Math.floor(Math.random()*10)}var m=f+""+l+""+c+""+h+""+p+""+o+""+u+""+a;var g;if(m.length==8){g=1}else{g=0}var y="";for(var b=0;b<6;b++){var w=Math.floor(Math.random()*textbase.length);y+=textbase.charAt(Math.floor(Math.random()*textbase.length))}var E="E";for(var b=0;b<9;b++){var w=Math.floor(Math.random()*plustext.length);E+=plustext.substring(w,w+1)}var S="E";for(var b=0;b<9;b++){var w=Math.floor(Math.random()*plustext.length);S+=plustext.substring(w,w+1)}var x="E";for(var b=0;b<9;b++){var w=Math.floor(Math.random()*plustext.length);x+=plustext.substring(w,w+1)}var T=t.getDate();if(T<10)T=""+T;var N=t.getFullYear();if(N<10)N="0"+N;var C=t.getMonth()+1;if(C<10)C="0"+C;var k=months[t.getMonth()];var L=textbase.charAt(t.getMonth());var A=t.getHours();if(A<10)A="0"+A;var O=t.getMinutes();if(O<10)O="0"+O;var M=s.getDate();if(M<10)M="0"+M;var _=s.getFullYear();if(_<10)_="0"+_;var D=s.getMonth()+1;if(D<10)D="0"+D;var P=months[s.getMonth()];var H=s.getHours();if(H<10)H="0"+H;var B=s.getMinutes();if(B<10)B="0"+B;localStorage.setItem("validuntil",i);localStorage.setItem("r1",o);localStorage.setItem("r2",u);localStorage.setItem("r3",a);localStorage.setItem("underline_link",g);localStorage.setItem("randomstring2nd",m);localStorage.setItem("randomstring",y);localStorage.setItem("aeoxrandom1",E);localStorage.setItem("aeoxrandom2",S);localStorage.setItem("aeoxrandom3",x);localStorage.setItem("order_Date",T);localStorage.setItem("order_Year",N);localStorage.setItem("order_Month",C);localStorage.setItem("order_Month2",L);localStorage.setItem("order_Month_text",k);localStorage.setItem("order_Hour",A);localStorage.setItem("order_Minute",O);localStorage.setItem("until_Date",M);localStorage.setItem("until_Year",_);localStorage.setItem("until_Month",D);localStorage.setItem("until_Minute",B);localStorage.setItem("until_Hour",H);localStorage.setItem("until_Minute",B);d(true)}function d(e){if(ticketType=="SL"){v(e)}else if(ticketType=="VT"){m(e)}}function v(e){var t=new Date;var n=new Array(7);n[0]="sön";n[1]="mån";n[2]="tis";n[3]="ons";n[4]="tor";n[5]="fre";n[6]="lör";var r=n[t.getDay()];var s=0;var o=t.getDate();var u="";if(localStorage.getItem("order_Date")==o){var r="idag";s=1}else if(localStorage.getItem("order_Date")==o-1){var r="igår";s=1}else if(localStorage.getItem("order_Date")==o-2){var r="i förrgår";s=1}if(s==0){u=localStorage.getItem("order_Date")+" "+localStorage.getItem("order_Month_text")}$("#msgtimetext").html("Meddelande</br>"+r+" "+u+' <span class="thin">'+localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute")+"</span>");$("#msgtimetext").append('<div class="doubletap-window" id="inbox-message"></div>');$("#messageview").before('<div class="btn_contacts" id="btn_contacts">'+"SL"+localStorage.getItem("r1")+""+localStorage.getItem("r2")+""+localStorage.getItem("r3")+"</div>");g("ticket");$("#b2message").html("SL"+localStorage.getItem("r1")+""+localStorage.getItem("r2")+""+localStorage.getItem("r3"));$("#ticketfromphonenr").html("SL"+localStorage.getItem("r1")+""+localStorage.getItem("r2")+""+localStorage.getItem("r3"));$("#ticketundertext").html(localStorage.getItem("zoneText1")+"-"+localStorage.getItem("zoneText2")+" "+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+" "+localStorage.getItem("r1")+""+localStorage.getItem("r2")+""+localStorage.getItem("r3")+'...<br /><span class="whitetext">&nbsp;</span>');$("#ticketgotit").html(localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute"));$("#senttophonenr").html("076-720 10 10");$("#ticketundertext2").html(localStorage.getItem("zoneText1")+""+localStorage.getItem("zoneText2")+"<br />&nbsp;");$("#ticketgotit2").html(localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute"));populateInbox(t);if(e){var a=300;var f="#inboxpage";currentViewportPage="inbox";i.scrollTo(0,-90,0)}else{var a=0;var f="#messagepage";currentViewportPage="message"}$("#viewport").scrollTo2(f,a)}function m(e){var t=new Date;var n=new Array(7);n[0]="sön";n[1]="mån";n[2]="tis";n[3]="ons";n[4]="tor";n[5]="fre";n[6]="lör";var r=n[t.getDay()];var s=0;var o=t.getDate();var u="";if(localStorage.getItem("order_Date")==o){var r="idag";s=1}else if(localStorage.getItem("order_Date")==o-1){var r="igår";s=1}else if(localStorage.getItem("order_Date")==o-2){var r="i förrgår";s=1}if(s==0){u=localStorage.getItem("order_Date")+" "+localStorage.getItem("order_Month_text")}$("#msgtimetext").html("Meddelande</br>"+r+" "+u+' <span class="thin">'+localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute")+"</span>");$("#msgtimetext").append('<div class="doubletap-window" id="inbox-message"></div>');$("#messageview").before('<div class="btn_contacts" id="btn_contacts">'+"VT"+localStorage.getItem("sender_number")+"</div>");g("ticket");$("#b2message").html("VT"+localStorage.getItem("sender_number"));$("#ticketfromphonenr").html("VT"+localStorage.getItem("sender_number"));$("#ticketundertext").html(localStorage.getItem("magic_number")+localStorage.getItem("msg_symbol")+" --VÄSTTRAFIK-- giltig till "+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+" "+localStorage.getItem("until_Year")+"-"+localStorage.getItem("until_Month")+"-"+localStorage.getItem("until_Date")+'...<br /><span class="whitetext">&nbsp;</span>');$("#ticketgotit").html(localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute"));$("#senttophonenr").html("070-726 27 28");$("#ticketundertext2").html(localStorage.getItem("zoneText2")+"<br />&nbsp;");$("#ticketgotit2").html(localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute"));populateInbox(t);if(e){var a=300;var f="#inboxpage";currentViewportPage="inbox";i.scrollTo(0,-90,0)}else{var a=0;var f="#messagepage";currentViewportPage="message"}$("#viewport").scrollTo2(f,a)}function g(e){if(ticketType=="SL")y(e);else if(ticketType=="VT")b(e)}function y(e){if(e=="ticket"){$("#b2messages").removeClass("back");$("#b2messages").css("background-image","url(img/btn_messages.png)");$("#slphone").html("SL"+localStorage.getItem("r1")+""+localStorage.getItem("r2")+""+localStorage.getItem("r3"));$("#btn_contacts").html("SL"+localStorage.getItem("r1")+""+localStorage.getItem("r2")+""+localStorage.getItem("r3"));$("#msgbubbleandlink").html('<div id="msgbubble" class="msgbubble"></div>');var t=$("#msgbubble");t.html(localStorage.getItem("zoneText1")+"-"+localStorage.getItem("zoneText2")+' <a href="javascript:addcalclick();">'+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+"</a> "+localStorage.getItem("r1")+""+localStorage.getItem("r2")+""+localStorage.getItem("r3")+"<br /><br />");t.append(localStorage.getItem("aeoxrandom1")+"<br />");t.append(localStorage.getItem("aeoxrandom2")+"<br />");t.append(localStorage.getItem("aeoxrandom3")+"<br />");t.append("EEEEEEEEEE<br /><br />");t.append('SL biljett giltig till <a href="javascript:addcalclick();">'+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+",<br />"+localStorage.getItem("until_Year")+"-"+localStorage.getItem("until_Month")+"-"+localStorage.getItem("until_Date")+"</a><br />");t.append(localStorage.getItem("priceText1")+" "+localStorage.getItem("priceText2")+" kr ink 6%<br />moms<br />");if(localStorage.getItem("underline_link")==1){t.append('<a href="tel:'+localStorage.getItem("randomstring")+" "+localStorage.getItem("randomstring2nd")+'">'+localStorage.getItem("randomstring")+" "+localStorage.getItem("randomstring2nd")+"</a><br />")}else{t.append('<a href="tel:'+localStorage.getItem("randomstring")+'">'+localStorage.getItem("randomstring")+'</a> <a href="tel:'+localStorage.getItem("randomstring2nd")+'">'+localStorage.getItem("randomstring2nd")+"</a><br />")}$("#msgbubble").css({"font-size":"34px"});t.append('<a href="http://mobil.sl.se">m.sl.se</a>');t.bind("doubletap",function(e){event.preventDefault();$("#inbox-message").fadeIn("fast");t.addClass("selected");copyVisible=true;$("#inbox-message").click(function(e){$("#inbox-message").fadeOut("fast");t.removeClass("selected");copyVisible=false})})}else if(e=="sent"){$("#b2messages").addClass("back");$("#b2messages").css("background-image","url(img/btn_back.png)");$("#slphone").html("076-720 10 10");$("#btn_contacts").html("076-720 10 10");if(localStorage.getItem("zoneText2").length==1){$("#msgbubbleandlink").html('<div class="msgbubble_small">'+localStorage.getItem("zoneText1")+""+localStorage.getItem("zoneText2")+"</div>")}else if(localStorage.getItem("zoneText2").length==2){$("#msgbubbleandlink").html('<div class="msgbubble_medium">'+localStorage.getItem("zoneText1")+""+localStorage.getItem("zoneText2")+"</div>")}else if(localStorage.getItem("zoneText2").length==3){$("#msgbubbleandlink").html('<div class="msgbubble_large">'+localStorage.getItem("zoneText1")+""+localStorage.getItem("zoneText2")+"</div>")}else{$("#msgbubbleandlink").html('<div class="msgbubble_xtralarge">'+localStorage.getItem("zoneText1")+""+localStorage.getItem("zoneText2")+"</div>")}}}function b(e){if(e=="ticket"){$("#b2messages").removeClass("back");$("#b2messages").css("background-image","url(img/btn_messages.png)");$("#slphone").html("VT"+localStorage.getItem("sender_number"));$("#btn_contacts").html("VT"+localStorage.getItem("sender_number"));$("#msgbubbleandlink").html('<div id="msgbubble" class="msgbubble"></div>');var t=$("#msgbubble");t.html(localStorage.getItem("magic_number")+localStorage.getItem("msg_symbol")+' --VÄSTTRAFIK-- giltig till <a href="javascript:addcalclick();">'+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+"<br />"+localStorage.getItem("until_Year")+"-"+localStorage.getItem("until_Month")+"-"+localStorage.getItem("until_Date")+"</a>"+"<br />");t.append(localStorage.getItem("zoneText1")+"<br />");var n=localStorage.getItem("code");t.append('<span style="font-size: 33px">'+localStorage.getItem("priceText1")+',00kr (inkl.6% moms)</span> <span style="font-size: 34px">'+n.substring(0,n.length-2)+"<br />"+n.substring(n.length-2,n.length)+"</span>");$("#msgbubble").css({"font-size":"32px"});t.bind("doubletap",function(e){event.preventDefault();$("#inbox-message").fadeIn("fast");t.addClass("selected");copyVisible=true;$("#inbox-message").click(function(e){$("#inbox-message").fadeOut("fast");t.removeClass("selected");copyVisible=false})});$("#slphone").animate({left:"30px"})}else if(e=="sent"){$("#b2messages").addClass("back");$("#b2messages").css("background-image","url(img/btn_back.png)");$("#slphone").html("070-726 27 28");$("#btn_contacts").html("070-726 27 28");var r=localStorage.getItem("zoneText2");if(r.length==2){$("#msgbubbleandlink").html('<div class="msgbubble_small">'+r+"</div>")}else if(r.length==3){$("#msgbubbleandlink").html('<div class="msgbubble_medium">'+r+"</div>")}else if(r.length==4){$("#msgbubbleandlink").html('<div class="msgbubble_large">'+r+"</div>")}else if(r.length==5){$("#msgbubbleandlink").html('<div class="msgbubble_xtralarge">'+r+"</div>")}else{$("#msgbubbleandlink").html('<div class="msgbubble_xtraxtralarge">'+r+"</div>")}}}var e=function(e){deviceWidth=$("#viewport").width();deviceHeight=$("#viewport").height();if(deviceWidth==640){currentOrientation="portrait"}else{currentOrientation="landscape"}if(deviceHeight<1e3){device="ip4"}else{device="ip5"}r.minScrollY=0;if(currPage=="ticket"){if(!keyboardVisible){$("#textinputmessage").animate({bottom:"0px"},e);var t=$("#msgbubble").outerHeight()+$("#msgtimetext").outerHeight();var n=$("#messagepage").height()-($(".navbartop").outerHeight()+88);var i=-(t-n*.85);i=i>=0?0:i;if(currentOrientation=="portrait"){r.maxScrollY=0;r.startY=0;r.scrollTo(0,0,e*4)}else if(currentOrientation=="landscape"){r.maxScrollY=i;r.startY=i;r.scrollTo(0,i,e*4)}}else if(keyboardVisible){$("#textinputmessage").animate({bottom:$("#textinputmessage").height()-88+"px"},e);var t=$("#msgbubble").outerHeight()+$("#msgtimetext").outerHeight();var n=$("#messagepage").height()-($(".navbartop").outerHeight()+$("#textinputmessage").height());var i=-(t-n*.85);i=i>=0?0:i;if(currentOrientation=="portrait"&&device=="ip4"){r.maxScrollY=i;r.startY=i;r.scrollTo(0,i,e*4)}else if(currentOrientation=="portrait"&&device=="ip5"){r.maxScrollY=i;r.startY=i;r.scrollTo(0,i,e*4)}else if(currentOrientation=="landscape"){var i=-(t-n*.5);r.maxScrollY=i;r.startY=i;r.scrollTo(0,i,e*4)}}}else if(currPage=="sent"){if(!keyboardVisible){$("#textinputmessage").animate({bottom:"0px"},e);if(currentOrientation=="portrait"){}else if(currentOrientation=="landscape"){r.maxScrollY=0;r.startY=0;r.scrollTo(0,0,e*4)}}else if(keyboardVisible){$("#textinputmessage").animate({bottom:$("#textinputmessage").height()-88+"px"},e);if(currentOrientation=="portrait"){}else if(currentOrientation=="landscape"){r.maxScrollY=-80;r.startY=-80;r.scrollTo(0,-80,e*4)}}}};var t=function(t){if(currentViewportPage=="settings"){$("#viewport").scrollTo2("#settings",0)}else if(currentViewportPage=="inbox"){$("#viewport").scrollTo2("#inboxpage",0)}else if(currentViewportPage=="message"){$("#viewport").scrollTo2("#messagepage",0)}else if(currentViewportPage=="about"){$("#viewport").scrollTo2("#about",0)}else{console.log("An orientation-error occured!")}setTimeout(function(){e(0);c();aboutScroll.maxScrollY=-($("#changes").height()-$("#aboutview").height()+$("#contact").height()+$("#status").height())},150)};$(window).bind("orientationchange",t);$(window).bind("resize",t);var n=Math.round((new Date).getTime()/1e3);if(parseInt(localStorage.getItem("validuntil"))>n){d(false)}else{$("#viewport").scrollTo2("#settings",0)}var r=new IScroll("#messageview",{click:true,tap:true});var i=new IScroll("#inboxcontent",{click:true,tap:true});i.scrollTo(0,-90,0);e(0);$("#textinputmessage").click(function(t){if(!keyboardVisible){keyboardVisible=true;e(200)}return});$("#popup_bg").click(function(){$("#popup_bg").fadeOut("fast");$("#addtocalendar").animate({bottom:"-400px"},200)});$("#addtocalendar").click(function(){$("#popup_bg").fadeOut("fast");$("#addtocalendar").animate({bottom:"-400px"},200)});var s=null;$("#b2messages, #b2message, #b1newmsg, #b2newmsg, #b_about_left").on("touchstart",this,function(e){$(this).css("background-position","0 60px");e.preventDefault()}).on("touchend",this,function(t){if(t.target.id=="b2messages"){$(this).css("background-position","0 0px");$("#slphone").animate({left:"3px"});$("#viewport").scrollTo2("#inboxpage",300);a();keyboardVisible=false;e(200);i.scrollTo(0,-90,0);currentViewportPage="inbox"}else if(t.target.id=="b1newmsg"){$(this).css("background-position","0 0px");$("#viewport").scrollTo2("#settings",300);currentViewportPage="settings"}else if(t.target.id=="b2message"){$(this).css("background-position","0 0px");a();keyboardVisible=false;$("#viewport").scrollTo2("#messagepage",300);currentViewportPage="message"}else if(t.target.id=="b2newmsg"){$(this).css("background-position","0 0px");a();$("#viewport").scrollTo2("#settings",300);currentViewportPage="settings"}else if(t.target.id=="b_about_left"){if(updateButtonActive){window.applicationCache.update()}}});$("#btn_edit1").on("touchstart",this,function(e){$("#btn_edit1").css({color:"rgba(89, 162, 252, 0.7)"})}).on("touchend",this,function(e){$("#btn_edit1").css({color:"rgb( 0, 122, 255 )"});a();$("#viewport").scrollTo2("#settings",300);currentViewportPage="settings"});$("#btn_edit2").on("touchstart",this,function(e){$("#btn_edit2").css({color:"rgba(89, 162, 252, 0.7)"})}).on("touchend",this,function(e){$("#btn_edit2").css({color:"rgb( 0, 122, 255 )"});var t=$("#btn_edit2");var n=200;if(t.text()=="Kontakt"){t.fadeOut(n).hide().text("Klar").fadeIn(n);$("#btn_contacts").fadeIn("fast").animate({top:"128px"},300);$("#slphone").fadeOut(n*2);contactbtnVisible=true}else{t.fadeOut(n).hide().text("Kontakt").fadeIn(n);$("#btn_contacts").delay(100).animate({top:"0px"},400).fadeOut("fast");$("#slphone").fadeIn(n*2);contactbtnVisible=false}});var o=window.applicationCache;o.onchecking=function(e){$("#statusmessage").html("Letar efter uppdateringar...");$("#statusmessage").css({color:"black"});$("#btn_home_about").html("i");$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"rgb( 13, 122, 255)"});updateButtonActive=false;$("#b_about_left").css("background-position","0 60px")};o.ondownloading=function(e){$("#statusmessage").html("Laddar ner...");$("#statusmessage").css({color:"blue"});$("#btn_home_about").html("!");$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"rgb( 13, 122, 255)"});updateButtonActive=false;$("#b_about_left").css("background-position","0 60px")};o.onnoupdate=function(e){$("#statusmessage").html("IRAA är online & uppdaterad");$("#statusmessage").css({color:"green"});$("#btn_home_about").html("i");$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"green"});updateButtonActive=true;$("#b_about_left").css("background-position","0 0px")};o.onprogress=function(e){message="Laddar ner... ";if(e.lengthComputable){$("#statusmessage").html(message+e.loaded+" av "+e.total+" filer")}else{$("#statusmessage").html(message)}$("#btn_home_about").html("...");$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"rgb( 245, 15, 15)"});updateButtonActive=false;$("#b_about_left").css("background-position","0 60px")};o.oncached=function(e){$("#statusmessage").html("iRAA använder en cachad version av sidan");$("#btn_home_about").html("i");$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"rgb( 13, 122, 255)"});updateButtonActive=true;$("#b_about_left").css("background-position","0 0px")};o.onupdateready=function(e){$("#statusmessage").html('En ny version finns tillgänglig! <a href="javascript:window.location.reload()">Klicka här för att installera!</a>');$("#statusmessage").css({color:"orange"});$("#btn_home_about").html("!");$("#btn_home_about").css({"border-color":"orange",color:"orange"});updateButtonActive=false;$("#b_about_left").css("background-position","0 60px");o.swapCache()};o.onobsolete=function(e){$("#statusmessage").html("Appcache är obsolete")};var u=0;o.onerror=function(e){u++;if(u<5){$("#statusmessage").html("iRAA är offline")}else{$("#statusmessage").html("iRAA är offline. Var vänlig starta om iRAA om du tror att det är fel.")}$("#statusmessage").css({color:"red"});$("#btn_home_about").html("i");$("#btn_home_about").css({"border-color":"rgb( 245, 15, 15 )",color:"rgb( 245, 15, 15)"});updateButtonActive=true;$("#b_about_left").css("background-position","0 0px")};$("#status").html('<h1 id="status">Status</h1><p id="statusmessage">Okänd status...</p><hr>');var a=function(){$("#textinputmessage").animate({bottom:"0px"},0);if(contactbtnVisible){$("#btn_edit2").fadeOut(200).hide().text("Kontakt").fadeIn(200);$("#btn_contacts").animate({top:"0px"},300).fadeOut("fast");$("#slphone").fadeIn(200*2);contactbtnVisible=false}};var f=function(){$.ajax({url:"./manifest.appcache",type:"get",dataType:"text",success:function(e){var t=e.split("\n")[2].replace("#","");$("#latestVersion").html(t)}})};var l=function(){$.ajax({url:"./CHANGES",type:"get",dataType:"text",success:function(e){var t=e.split("\n");$("#changes").append('<h1 id="changelog">Changelog</h1>');for(var n=0;n<t.length;n++){if(t[n].indexOf("# NYTT")!=-1){$("#changes").append("<h2>"+t[n]+"</h2>")}else if(t[n].indexOf("---------")!=-1){$("#changes").append("<hr>")}else{$("#changes").append("<p>"+t[n]+"</p>")}}}})};$("#chooseTicketBody").append('<div id="SL" class="town">Stockholm</div>').append('<div id="VT" class="town">Västtrafik</div>');$(".town").on("touchstart",this,function(e){$(this).css({"background-color":"rgb(200,200,200)"})}).on("touchend",this,function(e){$(this).css({"background-color":"rgb(247,247,247)"});chooseTicketVisible=false;$("#chooseTicketBody").fadeOut(200);$("#settingsHeader").fadeOut(150).hide().text("Ny "+e.target.id+" Biljett").fadeIn(150);$("#chooseTicketButton").delay(150).fadeIn(150);$("#btn_home_done").fadeIn(150);setTicketType(e.target.id+"");c()});var c=function(e){ticketScroll.maxScrollY=-($("#newticketform").height()-($("#settings").height()-$(".navbartop").outerHeight()-$(".smallhelptext").outerHeight()));ticketScroll.maxScrollY=ticketScroll.maxScrollY>0?0:ticketScroll.maxScrollY-30};$("#chooseTicketButton").on("touchstart",this,function(e){$("#chooseTicketButton").css({color:"rgba(89, 162, 252, 0.7)"})}).on("touchend",this,function(e){$("#chooseTicketButton").css({color:"rgb( 0, 122, 255 )"});if(!chooseTicketVisible){chooseTicketVisible=true;$("#chooseTicketBody").fadeIn(200);$("#settingsHeader").fadeOut(150).delay(150).hide().text("Välj stad").fadeIn(150);$("#chooseTicketButton").hide();$("#btn_home_done").fadeOut(150)}});$("#msgscrollablecontent").on("touchmove",this,function(t){if(contactbtnVisible){$("#btn_edit2").fadeOut(200).hide().text("Kontakt").fadeIn(200);$("#btn_contacts").animate({top:"0px"},300).fadeOut("fast");$("#slphone").fadeIn(200*2);contactbtnVisible=false}if(keyboardVisible){keyboardVisible=false;e(200)}if(copyVisible){$("#inbox-message").fadeOut("fast");$("#msgbubble").removeClass("selected");copyVisible=false}});$(".inboxitem").on("touchmove",this,function(e){dragged=true;$(this).css("background","white");$(this).find("div.inboxspace").css("background","white");$(this).find("*").css("color","black");$(this).find("div.inboxitemtext2").css("color","#808080");$(this).find("div.inboxgotit").css("color","#808080");$(this).find("img.listarrow").attr("src","img/listarrow.png")}).on("touchstart",this,function(e){dragged=false;var t=$(this);setTimeout(function(){if(!dragged){t.css("background","-webkit-linear-gradient(top, rgb(215, 215, 215), rgb(215, 215, 215))");t.find("div.inboxspace").css("background","-webkit-linear-gradient(top, rgb(215, 215, 215), rgb(215, 215, 215))");t.find("div.inboxspace").css("margin-top","-5")}},50);e.preventDefault()}).on("touchend",this,function(e){var t=$(this);setTimeout(function(){t.css("background","white");t.find("*").css("color","black");t.find("div.inboxitemtext2").css("color","#808080");t.find("div.inboxgotit").css("color","#808080");t.find("img.listarrow").attr("src","img/listarrow.png");t.find("div.inboxspace").css("background","white")},350);e.preventDefault()});$("#btn_home_about").bind("tap",function(e){$("#viewport").scrollTo2("#about",300);aboutScroll.maxScrollY=-($("#changes").height()-$("#aboutview").height()+$("#contact").height()+$("#status").height());aboutScroll.scrollToElement("#status");currentViewportPage="about"});$(".smallhelptext").bind("tap",function(e){$("#viewport").scrollTo2("#about",300);aboutScroll.maxScrollY=-($("#changes").height()-$("#aboutview").height()+$("#contact").height()+$("#status").height());aboutScroll.scrollToElement("#changelog");currentViewportPage="about"});$("#ticketlink").click(function(t){g("ticket");$("#viewport").scrollTo2("#messagepage",300);currPage="ticket";currentViewportPage="message";keyboardVisible=false;e(0);return false});$("#sentticketlink").click(function(t){g("sent");$("#viewport").scrollTo2("#messagepage",300);currPage="sent";currentViewportPage="message";keyboardVisible=false;e(0);return false});$("#btn_home_done").on("touchstart",this,function(e){$("#btn_home_done").css({color:"rgba(89, 162, 252, 0.7)"})}).on("touchend",this,function(e){$("#btn_home_done").css({color:"rgb( 0, 122, 255 )"})});$("#btn_home_done").click(function(e){if(ticketType=="SL"){p()}else if(ticketType=="VT"){h()}else{alert("Okänd biljett-typ!")}});f();l();aboutScroll=new IScroll("#aboutview",{click:true,tap:true,preventDefaultExceptionkey:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT|P)$/}});aboutScroll.maxScrollY=-($("#changes").height()-$("#aboutview").height()+$("#contact").height()+$("#status").height());$("#contact").append("<h1>Kontakt</h1>");$("#contact").append('<p>Underhåll: <a href="https://www.flashback.org/u499403">BillyMays @ Flashback</a></p><p>Donera: <br/>&nbsp;&nbsp;&nbsp;Bitcoin: <a href="https://blockchain.info/address/1NmRGFRmX8TACeD6ZcAxyAfhdYbPQf3Mo2">1NmRGFRmX8TACeD6ZcAxyAfhdYbPQf3Mo2</a></br >&nbsp;&nbsp;&nbsp;Barncancerfonden: <a href="http://www.barncancerfonden.se/stod-oss/Ge-en-gava/">Ge en gåva</a><br />&nbsp;&nbsp;&nbsp;Cancerfonden: <a href="http://www.cancerfonden.se/sv/Stod-oss/Ge-en-gava/">Ge en gåva</a></p><hr>');ticketScroll=new IScroll("#ticketview",{click:true,tap:true});c()})